<h1>掲示板アプリ</h1>

<!-- 新規投稿フォーム -->
<div style="background-color: #f0f0f0; padding: 15px; margin-bottom: 20px;">
  <h3>新規投稿</h3>
  
  <%# model: @post と書くことで、Postモデル用のフォームだとRailsが判断してくれる %>
  <%= form_with model: @post, url: posts_path, local: true do |f| %>
    
    <%# テキスト入力欄 %>
    <%= f.text_field :content, placeholder: "ここに入力してね" %>
    
    <%# 送信ボタン %>
    <%= f.submit "投稿する", class: "bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded" %>
    
  <% end %>
</div>

<hr>

<h2>投稿一覧</h2>

<%# @posts という配列から、1つずつ post に入れて繰り返す %>
<% @posts.each do |post| %>

    <div class="bg-white shadow rounded-lg p-6 mb-4 border border-gray-100">
      <div class="mb-2">
        <%# 1. 投稿内容（クリックで詳細へ） %>
        <%= link_to post_path(post), class: "hover:opacity-70" do %>
          <p class="text-lg font-bold text-gray-800"><%= post.content %></p>
        <% end %>
        
        <div class="text-sm text-gray-500 flex gap-3 mt-2">
          <%# 2. 投稿者情報 %>
          <span>投稿者: <%= post.user&.email || "退会済みユーザー" %></span>
          <%# 3. 投稿日 %>
          <span><%= post.created_at.strftime("%Y/%m/%d %H:%M") %></span>
        </div>
      </div>
      
      <%# ログインしていて、かつ、投稿者本人である場合のみ表示 %>
    <% if user_signed_in? && current_user.id == post.user_id %>
      <div class="flex gap-2">
        <%= link_to "編集", edit_post_path(post), class: "text-blue-500 hover:text-blue-700 underline" %>
        
        <%= link_to "削除", post_path(post), 
            data: { turbo_method: :delete, turbo_confirm: "本当に削除しますか？" }, 
            class: "text-red-500 hover:text-red-700 underline" %>
      </div>
    <% end %>
  </div>
<% end %>