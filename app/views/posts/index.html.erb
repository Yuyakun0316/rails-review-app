<h1>Êé≤Á§∫Êùø„Ç¢„Éó„É™</h1>

<!-- Ê§úÁ¥¢„Éï„Ç©„Éº„É†„Ç®„É™„Ç¢ -->
<div class="bg-white p-4 rounded-lg shadow mb-6 border border-gray-100">
  <p class="text-gray-500 text-sm mb-2">ÊäïÁ®ø„ÇíÊ§úÁ¥¢</p>
  
  <%# search_form_for „Å®„ÅÑ„ÅÜÂ∞ÇÁî®„ÅÆ„Éò„É´„Éë„Éº„Çí‰Ωø„ÅÑ„Åæ„Åô %>
  <%= search_form_for @q, url: root_path, class: "flex gap-2" do |f| %>
    
    <%# content_cont „Å®Êõ∏„Åè„Å®„Äåcontent„Ç´„É©„É†„ÅÆ‰∏≠„Å´(cont)Âê´„Åæ„Çå„Çã„Äç„Å®„ÅÑ„ÅÜÊ§úÁ¥¢„Å´„Å™„Çã %>
    <%= f.search_field :content_cont, placeholder: "„Ç≠„Éº„ÉØ„Éº„Éâ„ÇíÂÖ•Âäõ...", class: "border p-2 rounded w-full" %>
    
    <%= f.submit "Ê§úÁ¥¢", class: "bg-gray-700 text-white px-4 py-2 rounded hover:bg-gray-600 cursor-pointer" %>
    
  <% end %>
</div>

<!-- „Çø„ÉñÂàá„ÇäÊõø„Åà„Ç®„É™„Ç¢ -->
<div class="flex border-b border-gray-200 mb-6">
  <%# „Äå„Åô„Åπ„Å¶„Äç„Çø„Éñ %>
  <%# params[:type] „ÅåÁ©∫„Å™„Çâ„ÄÅ„Åì„Å£„Å°„Çí„Ç¢„ÇØ„ÉÜ„Ç£„ÉñÔºàÈªíÂ≠ó„Éª‰∏ãÁ∑öÔºâ„Å´„Åô„Çã %>
  <%= link_to "„Åô„Åπ„Å¶„ÅÆÊäïÁ®ø", root_path, 
      class: "flex-1 text-center py-3 #{params[:type].nil? ? 'border-b-2 border-blue-500 font-bold text-blue-600' : 'text-gray-500 hover:text-gray-700'}" %>

  <%# „Äå„Éï„Ç©„É≠„Éº‰∏≠„Äç„Çø„ÉñÔºà„É≠„Ç∞„Ç§„É≥ÊôÇ„ÅÆ„ÅøË°®Á§∫Ôºâ %>
  <% if user_signed_in? %>
    <%# params[:type] „Åå 'following' „Å™„Çâ„ÄÅ„Åì„Å£„Å°„Çí„Ç¢„ÇØ„ÉÜ„Ç£„Éñ„Å´„Åô„Çã %>
    <%= link_to "„Éï„Ç©„É≠„Éº‰∏≠", root_path(type: "following"), 
        class: "flex-1 text-center py-3 #{params[:type] == 'following' ? 'border-b-2 border-blue-500 font-bold text-blue-600' : 'text-gray-500 hover:text-gray-700'}" %>
  <% end %>
</div>

<!-- Êñ∞Ë¶èÊäïÁ®ø„Éï„Ç©„Éº„É† -->
<div style="background-color: #f0f0f0; padding: 15px; margin-bottom: 20px;">
  <h3>Êñ∞Ë¶èÊäïÁ®ø</h3>

<!-- „Éï„Ç©„Éº„É†ÂÖ®‰Ωì„ÇíÂõ≤„ÇÄdiv„Å´ data-controller „Çí„Å§„Åë„Çã -->
<!-- „Åì„Çå„Åß character_count_controller.js „Åå„Åì„ÅÆ„Ç®„É™„Ç¢„ÇíÁõ£Ë¶ñ„Åó„Åæ„Åô -->
<div data-controller="character-count">

  <%# model: @post „Å®Êõ∏„Åè„Åì„Å®„Åß„ÄÅPost„É¢„Éá„É´Áî®„ÅÆ„Éï„Ç©„Éº„É†„Å†„Å®Rails„ÅåÂà§Êñ≠„Åó„Å¶„Åè„Çå„Çã %>
  <%= form_with model: @post, url: posts_path, local: true do |f| %>
    
    <div class="mb-2">
      <%# ÂÖ•ÂäõÊ¨ÑÔºà„Çø„Éº„Ç≤„ÉÉ„ÉàÔºâ: data-character-count-target="input" %>
      <%# ÂÖ•Âäõ„Åô„Çã„Åü„Å≥„Å´Âãï„Åè„Ç¢„ÇØ„Ç∑„Éß„É≥: data-action="input->character-count#count" %>
      <%= f.text_area :content, 
          class: "w-full border p-2 rounded", 
          placeholder: "„Åì„Åì„Å´ÂÖ•Âäõ„Åó„Å¶„Å≠",
          rows: 3,
          data: { 
            character_count_target: "input", 
            action: "input->character-count#count" 
          } %>
      <!-- 1. „Ç≥„É≥„Éà„É≠„Éº„É©„Éº„ÇíÁ¥ê‰ªò„Åë -->
      <div class="mt-2" data-controller="image-preview">
        
        <!-- 2. „Éï„Ç°„Ç§„É´ÈÅ∏Êäû„Éú„Çø„É≥ -->
        <!-- data-image-preview-target="input" „ÇíËøΩÂä†ÔºàJS„Åã„Çâ„Éï„Ç°„Ç§„É´„ÇíÂèñÂæó„Åô„Çã„Åü„ÇÅÔºâ -->
        <!-- action: "change->..." „ÇíËøΩÂä†ÔºàÈÅ∏Êäû„ÅåÂ§â„Çè„Å£„Åü„ÇâÂãï„Åã„Åô„Åü„ÇÅÔºâ -->
        <%= f.file_field :image, 
            class: "text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100",
            data: { 
              image_preview_target: "input",
              action: "change->image-preview#preview" 
            } %>

        <!-- 3. „Éó„É¨„Éì„É•„ÉºË°®Á§∫Â†¥ÊâÄ -->
        <!-- ÊúÄÂàù„ÅØ‰Ωï„ÇÇË°®Á§∫„Åó„Å™„ÅÑ„ÅÆ„Åß hidden „ÇØ„É©„Çπ„Çí„Å§„Åë„Å¶„Åä„Åè -->
        <div class="mt-3">
          <img data-image-preview-target="output" class="rounded-lg max-h-60 object-cover hidden">
        </div>
        
      </div>
    </div>

    <!-- ÊñáÂ≠óÊï∞„ÇíË°®Á§∫„Åô„ÇãÂ†¥ÊâÄÔºà„Çø„Éº„Ç≤„ÉÉ„ÉàÔºâ -->
    <div class="text-right text-sm text-gray-500 mb-2">
      „ÅÇ„Å® <span data-character-count-target="output">140</span> ÊñáÂ≠ó
    </div>
    
    <%= f.submit "ÊäïÁ®ø„Åô„Çã", class: "btn-primary w-full" %>
    
  <% end %>
</div>

<hr>

<h2>ÊäïÁ®ø‰∏ÄË¶ß</h2>

<!-- grid-cols-1 („Çπ„Éû„Éõ„ÅØ1Âàó) / md:grid-cols-2 („Çø„Éñ„É¨„ÉÉ„Éà‰ª•‰∏ä„ÅØ2Âàó) / gap-6 (ÈöôÈñì„ÇíÁ©∫„Åë„Çã) -->
<div class="grid grid-cols-1 md:grid-cols-2 gap-6">
  <%# @posts „Å®„ÅÑ„ÅÜÈÖçÂàó„Åã„Çâ„ÄÅ1„Å§„Åö„Å§ post „Å´ÂÖ•„Çå„Å¶Áπ∞„ÇäËøî„Åô %>
  <% @posts.each do |post| %>
    <!-- „Ç´„Éº„ÉâËá™‰Ωì„ÅÆÂπÖÊåáÂÆö„Å™„Å©„ÅØÂâäÈô§„Åó„Å¶„ÄÅË¶™„ÅÆ„Ç∞„É™„ÉÉ„Éâ„Å´‰ªª„Åõ„Åæ„Åô -->
    <div class="bg-white shadow rounded-lg p-6 border border-gray-100 h-full flex flex-col justify-between">

      <div class="mb-2">
        <%# 1. ÊäïÁ®øÂÜÖÂÆπÔºà„ÇØ„É™„ÉÉ„ÇØ„ÅßË©≥Á¥∞„Å∏Ôºâ %>
        <%= link_to post_path(post), class: "hover:opacity-70" do %>
          <p class="text-lg font-bold text-gray-800"><%= post.content %></p>
        <% end %>

        <!-- ÁîªÂÉè„Åå„ÅÇ„Çå„Å∞Ë°®Á§∫ -->
        <% if post.image.attached? %>
          <div class="mt-3">
            <%# image_tag „ÅßÁîªÂÉè„ÇíË°®Á§∫„ÄÇ„Çµ„Ç§„Ç∫ÊåáÂÆö„Çí„Åó„Å¶„ÅØ„ÅøÂá∫„ÅóÈò≤Ê≠¢ %>
            <%= image_tag post.image, class: "rounded-lg max-h-60 object-cover" %>
          </div>
        <% end %>
        
        <div class="text-sm text-gray-500 flex gap-3 mt-2">
          <%# 2. ÊäïÁ®øËÄÖÊÉÖÂ†± %>
          <!-- <span>ÊäïÁ®øËÄÖ: <%= post.user&.email || "ÈÄÄ‰ºöÊ∏à„Åø„É¶„Éº„Ç∂„Éº" %></span> -->

          <!-- Â§âÊõ¥ÂæåÔºölink_to „ÅßÂõ≤„ÇÄ -->
          <div class="flex items-center gap-2 font-medium text-gray-600">
            
            <% if post.user %>
              <!-- „É¶„Éº„Ç∂„Éº„Åå„ÅÑ„ÇãÂ†¥ÂêàÔºö„Ç¢„Ç§„Ç≥„É≥ + ÂêçÂâç„É™„É≥„ÇØ -->
              <%# „Åï„Å£„Åç‰Ωú„Å£„Åü„Éò„É´„Éë„Éº„Çí‰Ωø„Å£„Å¶ÁîªÂÉè„ÇíË°®Á§∫Ôºà„Çµ„Ç§„Ç∫„ÅØÂ∞è„Åï„ÇÅ„ÅÆ25pxÔºâ %>
              <%= user_avatar(post.user, size: 25) %>
              
              <%= link_to post.user.email, user_path(post.user), class: "hover:text-blue-500 hover:underline" %>
            
            <% else %>
              <!-- „É¶„Éº„Ç∂„Éº„Åå„ÅÑ„Å™„ÅÑÔºàÈÄÄ‰ºöÊ∏à„ÅøÔºâÂ†¥Âêà -->
              <span>üë§ ÈÄÄ‰ºöÊ∏à„Åø„É¶„Éº„Ç∂„Éº</span>
            <% end %>
          </div>
          <%# 3. ÊäïÁ®øÊó• %>
          <span><%= post.created_at.strftime("%Y/%m/%d %H:%M") %></span>
        </div>
      </div>

  <!-- „Åì„Åì„Åã„Çâ„Éú„Çø„É≥„Ç®„É™„Ç¢Ôºöflex „Å® justify-between „ÅßÂ∑¶Âè≥„Å´ÈÖçÁΩÆ -->
  <div class="flex justify-between items-center mt-4 pt-2 border-t border-gray-100">

  <!-- Â∑¶ÂÅ¥Ôºö„ÅÑ„ÅÑ„Å≠„Éú„Çø„É≥„Ç®„É™„Ç¢ -->
    <div>
      <% if user_signed_in? %>
        <!-- „É≠„Ç∞„Ç§„É≥‰∏≠„Å™„Çâ„Éú„Çø„É≥„ÇíË°®Á§∫ -->
        <%= render 'likes/btn', post: post %>
      <% else %>
        <!-- „É≠„Ç∞„Ç¢„Ç¶„Éà‰∏≠„ÅØ„Éè„Éº„Éà„ÅÆÊï∞„Å†„ÅëË°®Á§∫ -->
        <span class="text-gray-400">‚ô° <%= post.likes.count %></span>
      <% end %>
    </div>
      
      <%# „É≠„Ç∞„Ç§„É≥„Åó„Å¶„ÅÑ„Å¶„ÄÅ„Åã„Å§„ÄÅÊäïÁ®øËÄÖÊú¨‰∫∫„Åß„ÅÇ„ÇãÂ†¥Âêà„ÅÆ„ÅøË°®Á§∫ %>
    <% if user_signed_in? && current_user.id == post.user_id %>
      <div class="flex gap-2">
        <%= link_to "Á∑®ÈõÜ", edit_post_path(post), class: "text-blue-500 hover:text-blue-700 underline" %>
        
        <%= link_to "ÂâäÈô§", post_path(post), 
            data: { turbo_method: :delete, turbo_confirm: "Êú¨ÂΩì„Å´ÂâäÈô§„Åó„Åæ„Åô„ÅãÔºü" }, 
            class: "text-red-500 hover:text-red-700 underline" %>
      </div>
    <% end %>
  </div>
</div>
<% end %>
</div>

<!-- „Éö„Éº„Ç∏ÈÄÅ„Çä„Éú„Çø„É≥ -->
<div class="mt-4 flex justify-center pb-10">
  <%= paginate @posts %>
</div>